from src.core.routing.decorator.route import Route
from src.core.controller.abstract_controller import AbstractController
from typing import Optional, Dict
from src.repository.{{ repository_file_name }} import {{ repository_class_name }}
from src.entity.{{ entity_file_name }} import {{ entity_class_name }}


class {{ controller_class_name }}(AbstractController):
    @Route("/{{ entity_name }}", "get_all_{{ entity_name }}", methods=["GET"])
    async def get_all_{{ entity_name }}(self):
        return {{ repository_class_name }}().find_all()

    @Route("/{{ entity_name }}/search", "search_several_{{ entity_name }}", methods=["POST"])
    async def search_several_{{ entity_name }}(
        self,
        criteria: Dict[str, str],
        order_by: Optional[Dict[str, str]] = None,
        limit: Optional[int] = None,
        offset: Optional[int] = None,
    ):
        entities = {{ repository_class_name }}().find_by(criteria, order_by, limit, offset)
        return entities

    @Route("/{{ entity_name }}/find", "get_{{ entity_name }}", methods=["POST"])
    async def get_{{ entity_name }}(self, keys_formula: {{ entity_class_name }}.generate_find_model()):
        return {{ repository_class_name }}().find(keys_formula.dict())

    @Route("/{{ entity_name }}", "create_{{ entity_name }}", methods=["POST"])
    async def create_{{ entity_name }}(self, {{ entity_name }}: {{ entity_class_name }}.generate_create_model()):
        entity_instance = {{ repository_class_name }}().model(**{{ entity_name }}.dict())
        self.entity_manager.persist(entity_instance)
        self.entity_manager.commit()

    @Route("/{{ entity_name }}", "update_{{ entity_name }}", methods=["PUT"])
    async def update_{{ entity_name }}(self, {{ entity_name }}: {{ entity_class_name }}):
        self.entity_manager.persist({{ entity_name }})
        self.entity_manager.commit()

    @Route("/{{ entity_name }}/{id}", "delete_{{ entity_name }}", methods=["DELETE"])
    async def delete_{{ entity_name }}(self, id: int):
        entity_instance = {{ repository_class_name }}().find(id)
        self.entity_manager.delete(entity_instance)
        self.entity_manager.commit()
{% raw %}{% endraw %}